<!DOCTYPE html>
<!--[if lte IE 6]><html class="preIE7 preIE8 preIE9"><![endif]-->
<!--[if IE 7]><html class="preIE8 preIE9"><![endif]-->
<!--[if IE 8]><html class="preIE9"><![endif]-->
<!--[if gte IE 9]><!--><html><!--<![endif]-->
  <head>
    <meta charset="UTF-8">
    <title>TypeSwitch</title>
    <link href="styles/default.css" rel="stylesheet" type="text/css"></link>
    <link href="https://fonts.googleapis.com/css?family=Alegreya+Sans:800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Changa:300" rel="stylesheet">
  </head>
  <body>
    <div id="header"><p id="title">TypeSwitch v1.0.0</p></div>
    <div id="gameContainer">
      <div id="prompt"></div>
      <div id="underScore">_</div>
    </div>
    <div id="console">
      <img id="playButton" src="resources/play.png" alt="play button"/>
      <h2 id="timerTitle">Elapsed Time:</h2>
      <h3 id="timer">0</h3>
      <h2 id="WPMTitle">WPM</h2>
      <h3 id="WPM">0</h3>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="../build/type-switch.min.js"></script>
    <script>
    $(document).ready(function () {
      var Game = new TypeSwitch({stubbornMode: true});
      var elapsedTime = setInterval(function () {
        $('#timer').text(Game.getGameStats().time);
      }, 1000);

      function appendGamePrompt(newPrompt) {
        newPrompt.split('').map(function (letter, i) {
          var letterContainer = document.createElement('p');
          letterContainer.setAttribute('class', 'letter');
          var node = document.createTextNode(letter);
          letterContainer.appendChild(node);
          return letterContainer;
        }).forEach(function (node) {
          document.getElementById('prompt').appendChild(node);
        });
      }

      function setLetterColor() {
        var letters = document.querySelectorAll('.letter');
        for (var i = 0, length = letters.length; i < length; i++) {
          var currentLetter = letters[i];
          if (i < Game.getGameStats().currentIndex) {
            currentLetter.setAttribute('class', 'letter done');
          }
          else if (i === Game.getGameStats().currentIndex) {
            currentLetter.setAttribute('class', 'letter active');
          } else {
            currentLetter.setAttribute('class', 'letter queued');
          }
        }
      }

      function loopFade(el){
        el.style.opacity = .4;
        (function fade() {
          if ((el.style.opacity -= .04) < 0) {
            el.style.opacity = .4;
          } else {
            requestAnimationFrame(fade);
          }
        })();
      }

      function shiftPrompt() {
        var totalOffset = 0;
        $('.done').each(function () {
          totalOffset += $(this).width();
        });
        totalOffset += $('.active').width() / 2;
        $('#prompt').css('transform', 'translateX(-' + totalOffset + 'px)');
      }

      $('#playButton').on('click', function () {
          Game.start('TypeSwitch');
          appendGamePrompt('TypeSwitch');
          setLetterColor();
          shiftPrompt();
          $(this).css('opacity', .2);
      });

      Game.on('correct', function () {
        setLetterColor();
        shiftPrompt();
        loopFade(document.getElementById('underScore'));
        console.log(Game.getGameStats());
      });
      Game.on('incorrect', function () {
        // alertIncorrect();
      });
      Game.on('complete', function () {
        Game.resetGame();
        console.log('complete ', Game.getGameStats());
        setLetterColor();
        shiftPrompt();
        $('#playButton').css('opacity', 1);
      });
    });
    </script>
  </body>
</html>
