<!DOCTYPE html>
<!--[if lte IE 6]><html class="preIE7 preIE8 preIE9"><![endif]-->
<!--[if IE 7]><html class="preIE8 preIE9"><![endif]-->
<!--[if IE 8]><html class="preIE9"><![endif]-->
<!--[if gte IE 9]><!--><html><!--<![endif]-->
  <head>
    <meta charset="UTF-8">
    <title>TypeSwitch</title>
    <link href="styles/default.css" rel="stylesheet" type="text/css"></link>
    <link href="https://fonts.googleapis.com/css?family=Alegreya+Sans:800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Changa:300" rel="stylesheet">
  </head>
  <body>
    <div id="sheath"></div>
    <div id="particles"></div>
    <div id="header"><p id="title">TypeSwitch v1.0.0</p></div>
    <div id="gameContainer">
      <div id="prompt"></div>
      <div id="underScore">_</div>
    </div>
    <div id="console">
      <img id="playButton" src="resources/play.png" alt="play button"/>
      <h2 id="timerTitle">Elapsed Time:</h2>
      <h3 id="timer">0</h3>
      <h2 id="WPMTitle">WPM</h2>
      <h3 id="WPM">0</h3>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="../build/type-switch.min.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
    $(document).ready(function () {
      var Game = new TypeSwitch({stubbornMode: true});
      var elapsedTime = setInterval(function () {
        $('#timer').text(Game.getGameStats().time);
      }, 1000);
      var prompt = 'Introducing TypeSwitch, a flexible keypress event module! Track input, accuracy, and duration out of the box! Focus on your UI, while TypeSwitch feeds you the good stuff!'

      function appendGamePrompt(newPrompt) {
        newPrompt.split('').map(function (letter, i) {
          var letterContainer = document.createElement('p');
          if (letter === ' ') {
            letter = 'W';
            letterContainer.style.opacity = '0';
          }
          letterContainer.setAttribute('class', 'letter');
          var node = document.createTextNode(letter);
          letterContainer.appendChild(node);
          return letterContainer;
        }).forEach(function (node) {
          document.getElementById('prompt').appendChild(node);
        });
      }

      function setLetterColor() {
        var letters = document.querySelectorAll('.letter');
        for (var i = 0, length = letters.length; i < length; i++) {
          var currentLetter = letters[i];
          if (i < Game.getGameStats().currentIndex) {
            currentLetter.setAttribute('class', 'letter done');
          }
          else if (i === Game.getGameStats().currentIndex) {
            currentLetter.setAttribute('class', 'letter active');
          } else {
            currentLetter.setAttribute('class', 'letter queued');
          }
        }
      }

      function unsheathParticles(el, val) {
        el.style.opacity = val;
        (function fade() {
          if ((el.style.opacity -= (val / 10)) < 0) {
            el.style.opacity = 0;
            sheathParticles(el, val);
          } else {
            requestAnimationFrame(fade);
          }
        })();
      }

      function sheathParticles(el, val) {
        el.style.opacity = 0;
        (function fade() {
          if ((el.style.opacity += (val / 10)) > val) {
            el.style.opacity = val;
          } else {
            requestAnimationFrame(fade);
          }
        })();
      }

      function loopFadeOut(el, val){
        el.style.opacity = val;
        (function fade() {
          if ((el.style.opacity -= (val / 10)) < 0) {
            el.style.opacity = val;
          } else {
            requestAnimationFrame(fade);
          }
        })();
      }

      function shiftPrompt() {
        var totalOffset = 0;
        $('.done').each(function () {
          totalOffset += $(this).width() - 1;
        });
        totalOffset += $('.active').width() / 2;
        $('#prompt').css('transform', 'translateX(-' + totalOffset + 'px)');
      }

      $('#playButton').on('click', function () {
          Game.start(prompt);
          appendGamePrompt(prompt);
          setLetterColor();
          shiftPrompt();
          $(this).css('opacity', .2);
      });

      Game.on('correct', function () {
        var gameStats = Game.getGameStats();
        setLetterColor();
        shiftPrompt();
        loopFadeOut(document.getElementById('underScore'), .4);
        if (gameStats.prompt[gameStats.currentIndex] === ' ') {
          $('#sheath').fadeOut(0, function () {
            $('#sheath').fadeIn(700);
          });
        }
      });
      Game.on('incorrect', function () {
        // alertIncorrect();
      });
      Game.on('complete', function () {
        Game.resetGame();
        console.log('complete ', Game.getGameStats());
        $('#prompt').html('');
        $('#playButton').css('opacity', 1);
      });

      particlesJS("particles", {
        "particles": {
          "number": {
            "value": 30,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": '#1a1a1a'
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#FFFFFF"
            },
            "polygon": {
              "nb_sides": 5
            },
          },
          "opacity": {
            "value": .2,
            "random": false,
            "anim": {
              "enable": false,
              "speed": 1,
              "opacity_min": 0.1,
              "sync": false
            }
          },
          "size": {
            "value": 0,
            "random": false,
            "anim": {
              "enable": false,
              "speed": 40,
              "size_min": 0.1,
              "sync": false
            }
          },
          "line_linked": {
            "enable": true,
            "distance": 550,
            "color": "#00b386",
            "opacity": .05,
            "width": 500
          },
          "move": {
            "enable": true,
            "speed": 80,
            "direction": "none",
            "random": true,
            "straight": false,
            "out_mode": "out",
            "bounce": false,
            "attract": {
              "enable": false,
              "rotateX": 600,
              "rotateY": 1200
            }
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": {
              "enable": false
            },
            "onclick": {
              "enable": false
            },
            "resize": true
          }
        },
        "retina_detect": true
      });
    });
    </script>
  </body>
</html>
